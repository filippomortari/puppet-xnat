== XNAT puppet module ==

This module configures an XNAT installation.

Installation instruction (some steps may not be required on existing systems)

 - Log in as root
 - Create two new users: useradd xnat and useradd tomcat
 - Remove existing OpenJDK java packages: 
 - run rpm -qa | grep jdk
   - Remove the openjdk packages in that list. The first part is sufficient e.g. java-1.6.0-openjdk
   - Ubuntu: this is not required on Ubuntu as this supports a special program that can selected the correct Java version automatically.
 - Install rubygems
   - Ubuntu: sudo apt-get install rubygems
   - Fedora: sudo yum install rubygems
   - RedHat: 
     - yum-config-manager --enable rhel-6-server-optional-rpms
	 - yum install rubygems (confirm any required keys)
 - Install puppet
   - Fedora: sudo yum install puppet
   - Ubuntu: sudo apt-get install puppet
   - RedHat: 
     - sudo rpm -ivh http://yum.puppetlabs.com/el/6/products/i386/puppetlabs-release-6-7.noarch.rpm
     - Replace the 6’s with 5’s if that is the installed RedHat version. Replace i386 with x86_64 for systems with a 64-bit instruction set.
     - Install puppet: yum install puppet (confirm any required keys)
 - Install other packages: yum install wget git mercurial (confirm any required keys)
 - Update the operating system: yum update
 - Retrieve the puppet repository: git clone https://bitbucket.org/bigr_erasmusmc/puppet-xnat /etc/puppet/modules/xnat (space after puppet-xnat)
 - Run install script (also runs Puppet script). sh /etc/puppet/modules/xnat/preinstall.sh
 - Errors that stdlib and concat are already installed can be ignored.
 - Warnings about deprecated variables can be ignored.
 - The output of the puppet script can be found in /puppet.out
 - The complete installation can take up to an hour depending on internet/computer speed. 
 - Update tomcat port
  - Open /usr/share/tomcat7/conf/server.xml
  - Edit <Connector connectionTimeout="20000" port="8080" protocol="HTTP/1.1" redirectPort="8443"/>: change port 8080 to 80
  - Tomcat can be restarted with: su tomcat -c 'sh /usr/share/tomcat7/bin/shutdown.sh'

Known issues with installation:
 - Sometimes tomcat does not shutdown properly and therefore multiple instances are running. If the website is not reachable, check with ps aux | grep java if multiple tomcat instances are running. If this is the cast, kill the processes with kill -9 [PID from ps aux] and restart tomcat with sh /usr/share/tomcat7/bin/startup.sh . After about a minute the website should be reachable.
